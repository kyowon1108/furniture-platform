# í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡° ìƒì„¸ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
2. [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#ë””ë ‰í† ë¦¬-êµ¬ì¡°)
3. [í•µì‹¬ ì»´í¬ë„ŒíŠ¸](#í•µì‹¬-ì»´í¬ë„ŒíŠ¸)
4. [ìƒíƒœ ê´€ë¦¬](#ìƒíƒœ-ê´€ë¦¬)
5. [3D ë Œë”ë§](#3d-ë Œë”ë§)
6. [ì‹¤ì‹œê°„ í†µì‹ ](#ì‹¤ì‹œê°„-í†µì‹ )

---

## ì•„í‚¤í…ì²˜ ê°œìš”

í”„ë¡ íŠ¸ì—”ë“œëŠ” **Next.js 14 App Router**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, **React Three Fiber**ë¡œ 3D ì”¬ì„ ë Œë”ë§í•©ë‹ˆë‹¤.

```
ì‚¬ìš©ì ì¸í„°ë™ì…˜
    â†“
React ì»´í¬ë„ŒíŠ¸
    â†“
Zustand ìŠ¤í† ì–´ (ìƒíƒœ ê´€ë¦¬)
    â†“
API Client / Socket.IO
    â†“
ë°±ì—”ë“œ ì„œë²„
```

---

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
frontend/
â”œâ”€â”€ app/                        # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx             # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ page.tsx               # ëœë”© í˜ì´ì§€
â”‚   â”œâ”€â”€ globals.css            # ì „ì—­ ìŠ¤íƒ€ì¼
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                  # ì¸ì¦ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â””â”€â”€ register/page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ projects/              # í”„ë¡œì íŠ¸ í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â””â”€â”€ editor/                # ì—ë””í„° í˜ì´ì§€
â”‚       â””â”€â”€ [projectId]/page.tsx
â”‚
â”œâ”€â”€ components/                 # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ 3d/                    # 3D ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Scene.tsx          # ë©”ì¸ 3D ì”¬
â”‚   â”‚   â”œâ”€â”€ Furniture.tsx      # ê°€êµ¬ ë©”ì‹œ
â”‚   â”‚   â”œâ”€â”€ Room.tsx           # ë°© ê²½ê³„
â”‚   â”‚   â””â”€â”€ PlyModel.tsx       # PLY ëª¨ë¸ ë Œë”ë§
â”‚   â”‚
â”‚   â””â”€â”€ ui/                    # UI ì»´í¬ë„ŒíŠ¸
â”‚       â”œâ”€â”€ Toolbar.tsx        # íˆ´ë°”
â”‚       â”œâ”€â”€ Sidebar.tsx        # ì‚¬ì´ë“œë°” (ì¹´íƒˆë¡œê·¸)
â”‚       â”œâ”€â”€ Toast.tsx          # ì•Œë¦¼
â”‚       â”œâ”€â”€ Navbar.tsx         # ë„¤ë¹„ê²Œì´ì…˜
â”‚       â”œâ”€â”€ MeasurePanel.tsx   # ì¸¡ì • íŒ¨ë„
â”‚       â”œâ”€â”€ LightingPanel.tsx  # ì¡°ëª… íŒ¨ë„
â”‚       â”œâ”€â”€ ConnectionStatus.tsx
â”‚       â””â”€â”€ CreateProjectModal.tsx
â”‚
â”œâ”€â”€ hooks/                      # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ useKeyboard.ts         # í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
â”‚   â”œâ”€â”€ useSocket.ts           # WebSocket ì—°ê²°
â”‚   â””â”€â”€ useAutoSave.ts         # ìë™ ì €ì¥
â”‚
â”œâ”€â”€ lib/                        # ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ api.ts                 # REST API í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ socket.ts              # Socket.IO í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ store/                      # Zustand ìŠ¤í† ì–´
â”‚   â”œâ”€â”€ authStore.ts           # ì¸ì¦ ìƒíƒœ
â”‚   â”œâ”€â”€ editorStore.ts         # ì—ë””í„° ìƒíƒœ
â”‚   â””â”€â”€ toastStore.ts          # ì•Œë¦¼ ìƒíƒœ
â”‚
â”œâ”€â”€ types/                      # TypeScript íƒ€ì…
â”‚   â”œâ”€â”€ furniture.ts           # ê°€êµ¬ íƒ€ì…
â”‚   â”œâ”€â”€ api.ts                 # API íƒ€ì…
â”‚   â””â”€â”€ catalog.ts             # ì¹´íƒˆë¡œê·¸ íƒ€ì…
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ next.config.js
```

---

## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. Scene.tsx - 3D ì”¬

**ì—­í• **: Three.js ì”¬ ë Œë”ë§, ì¡°ëª…, ì¹´ë©”ë¼ ì„¤ì •

```typescript
export function Scene() {
  const furnitures = useEditorStore((state) => state.furnitures);
  const timeOfDay = useEditorStore((state) => state.timeOfDay);
  
  return (
    <Canvas camera={{ position: [10, 10, 10], fov: 50 }} shadows>
      <ambientLight intensity={lighting.ambient} />
      <directionalLight
        position={lighting.position}
        intensity={lighting.intensity}
        color={lighting.color}
        castShadow
      />
      
      <Grid />
      <Room />
      
      {furnitures.map((furniture) => (
        <Furniture key={furniture.id} {...furniture} />
      ))}
      
      <OrbitControls />
    </Canvas>
  );
}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- ë™ì  ì¡°ëª… (ì‹œê°„ëŒ€ë³„)
- ê°€êµ¬ ë Œë”ë§
- ì¸¡ì • í¬ì¸íŠ¸ í‘œì‹œ
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›

---

### 2. Furniture.tsx - ê°€êµ¬ ë©”ì‹œ

**ì—­í• **: ê°œë³„ ê°€êµ¬ 3D ë©”ì‹œ ë Œë”ë§

```typescript
export function Furniture(props: FurnitureItem) {
  const selectedIds = useEditorStore((state) => state.selectedIds);
  const isSelected = selectedIds.includes(props.id);
  const color = props.isColliding ? '#ef4444' : props.color;
  
  return (
    <group position={[props.position.x, props.position.y, props.position.z]}>
      <mesh castShadow receiveShadow>
        <boxGeometry args={[width, height, depth]} />
        <meshStandardMaterial color={color} />
      </mesh>
      
      {isSelected && <edgesGeometry />}
    </group>
  );
}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- ê°€êµ¬ ë©”ì‹œ ë Œë”ë§
- ì„ íƒ ì‹œ ì™¸ê³½ì„  í‘œì‹œ
- ì¶©ëŒ ì‹œ ë¹¨ê°„ìƒ‰ í‘œì‹œ
- í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬

---

### 3. Toolbar.tsx - íˆ´ë°”

**ì—­í• **: ì—ë””í„° ë„êµ¬ ëª¨ìŒ

```typescript
export function Toolbar() {
  const { transformMode, canUndo, canRedo, undo, redo } = useEditorStore();
  
  return (
    <div className="toolbar">
      {/* Undo/Redo */}
      <button onClick={undo} disabled={!canUndo}>â†¶</button>
      <button onClick={redo} disabled={!canRedo}>â†·</button>
      
      {/* Transform Modes */}
      <button onClick={() => setTransformMode('translate')}>â†” ì´ë™</button>
      <button onClick={() => setTransformMode('rotate')}>â†» íšŒì „</button>
      <button onClick={() => setTransformMode('scale')}>â‡² í¬ê¸°</button>
      
      {/* Save/Export */}
      <button onClick={saveLayout}>ğŸ’¾ ì €ì¥</button>
      <button onClick={exportPNG}>ğŸ“¸ PNG</button>
    </div>
  );
}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- Undo/Redo ë²„íŠ¼
- Transform ëª¨ë“œ ì „í™˜
- ì €ì¥/ë‚´ë³´ë‚´ê¸°
- ë§ˆì§€ë§‰ ì €ì¥ ì‹œê°„ í‘œì‹œ

---

### 4. Sidebar.tsx - ê°€êµ¬ ì¹´íƒˆë¡œê·¸

**ì—­í• **: ê°€êµ¬ ëª©ë¡ ë° ê²€ìƒ‰

```typescript
export function Sidebar() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  
  const filteredFurniture = useMemo(() => {
    return FURNITURE_CATALOG.filter((item) => {
      const matchesSearch = item.name.includes(searchQuery);
      const matchesCategory = selectedCategory === 'all' || item.category === selectedCategory;
      return matchesSearch && matchesCategory;
    });
  }, [searchQuery, selectedCategory]);
  
  return (
    <div className="sidebar">
      <input type="text" placeholder="ê²€ìƒ‰..." onChange={...} />
      <div className="categories">{...}</div>
      <div className="furniture-list">
        {filteredFurniture.map((item) => (
          <div draggable onClick={handleClick}>{...}</div>
        ))}
      </div>
    </div>
  );
}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- ê°€êµ¬ ê²€ìƒ‰
- ì¹´í…Œê³ ë¦¬ í•„í„°
- ë“œë˜ê·¸ ì•¤ ë“œë¡­
- í´ë¦­ìœ¼ë¡œ ì¶”ê°€

---

## ìƒíƒœ ê´€ë¦¬ (Zustand)

### 1. editorStore.ts - ì—ë””í„° ìƒíƒœ

**ì£¼ìš” ìƒíƒœ**:
```typescript
interface EditorState {
  // ê¸°ë³¸
  projectId: number | null;
  furnitures: FurnitureItem[];
  selectedIds: string[];
  transformMode: TransformMode;
  
  // ì €ì¥
  isSaving: boolean;
  lastSaved: Date | null;
  hasUnsavedChanges: boolean;
  
  // Undo/Redo
  historyStack: LayoutState[];
  historyIndex: number;
  canUndo: boolean;
  canRedo: boolean;
  
  // ì¸¡ì •
  measureMode: MeasureMode;
  measurePoints: Vector3[];
  
  // ì¡°ëª…
  timeOfDay: TimeOfDay;
  
  // í´ë¦½ë³´ë“œ
  clipboard: FurnitureItem[];
}
```

**ì£¼ìš” ì•¡ì…˜**:
- `addFurniture()`: ê°€êµ¬ ì¶”ê°€
- `updateFurniture()`: ê°€êµ¬ ìˆ˜ì •
- `deleteFurniture()`: ê°€êµ¬ ì‚­ì œ
- `undo()` / `redo()`: ì‹¤í–‰ ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰
- `saveLayout()`: ë ˆì´ì•„ì›ƒ ì €ì¥
- `copySelected()` / `paste()`: ë³µì‚¬/ë¶™ì—¬ë„£ê¸°

---

### 2. authStore.ts - ì¸ì¦ ìƒíƒœ

**ì£¼ìš” ìƒíƒœ**:
```typescript
interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  
  login: (email, password) => Promise<void>;
  logout: () => void;
  fetchUser: () => Promise<void>;
}
```

---

### 3. toastStore.ts - ì•Œë¦¼ ìƒíƒœ

**ì£¼ìš” ìƒíƒœ**:
```typescript
interface ToastState {
  toasts: Toast[];
  addToast: (message, type) => void;
  removeToast: (id) => void;
}
```

---

## 3D ë Œë”ë§

### React Three Fiber êµ¬ì¡°

```
Canvas (Three.js ì»¨í…ìŠ¤íŠ¸)
  â”œâ”€â”€ Lights (ì¡°ëª…)
  â”‚   â”œâ”€â”€ ambientLight
  â”‚   â””â”€â”€ directionalLight
  â”‚
  â”œâ”€â”€ Grid (ê·¸ë¦¬ë“œ)
  â”‚
  â”œâ”€â”€ Room (ë°© ê²½ê³„)
  â”‚   â”œâ”€â”€ Line (ê²½ê³„ì„ )
  â”‚   â””â”€â”€ Plane (ë°”ë‹¥)
  â”‚
  â”œâ”€â”€ Furniture[] (ê°€êµ¬ ëª©ë¡)
  â”‚   â””â”€â”€ mesh + geometry + material
  â”‚
  â”œâ”€â”€ MeasurePoints[] (ì¸¡ì • í¬ì¸íŠ¸)
  â”‚
  â””â”€â”€ OrbitControls (ì¹´ë©”ë¼ ì»¨íŠ¸ë¡¤)
```

### ì¡°ëª… ì‹œìŠ¤í…œ

```typescript
const lightingConfig = {
  morning: { position: [10, 10, 5], intensity: 1.2, color: '#FFFACD' },
  afternoon: { position: [0, 10, 0], intensity: 1.5, color: '#FFFFFF' },
  evening: { position: [-10, 5, 5], intensity: 0.8, color: '#FFB347' },
  night: { position: [0, 5, 0], intensity: 0.3, color: '#4169E1' },
};
```

---

## ì‹¤ì‹œê°„ í†µì‹ 

### Socket.IO í´ë¼ì´ì–¸íŠ¸

```typescript
class SocketService {
  connect(projectId, userId) {
    this.socket = io(SOCKET_URL);
    this.socket.on('connect', () => {
      this.socket.emit('join_project', { project_id, user_id });
    });
  }
  
  emitFurnitureMove(furnitureId, position, rotation) {
    this.socket.emit('furniture_move', { ... });
  }
  
  on(event, callback) {
    this.socket.on(event, callback);
  }
}
```

### ì´ë²¤íŠ¸ ì²˜ë¦¬

```typescript
useEffect(() => {
  const socket = socketService.connect(projectId, userId);
  
  socket.on('furniture_updated', (data) => {
    updateFurniture(data.furniture_id, { position, rotation });
  });
  
  socket.on('furniture_added', (data) => {
    addFurniture(data.furniture);
  });
  
  return () => socketService.disconnect();
}, [projectId, userId]);
```

---

## í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤

| ë‹¨ì¶•í‚¤ | ê¸°ëŠ¥ |
|--------|------|
| `T` | ì´ë™ ëª¨ë“œ |
| `R` | íšŒì „ ëª¨ë“œ |
| `S` | í¬ê¸° ëª¨ë“œ |
| `Ctrl+Z` | ì‹¤í–‰ ì·¨ì†Œ |
| `Ctrl+Y` | ë‹¤ì‹œ ì‹¤í–‰ |
| `Ctrl+C` | ë³µì‚¬ |
| `Ctrl+V` | ë¶™ì—¬ë„£ê¸° |
| `Ctrl+S` | ì €ì¥ |
| `Delete` | ì‚­ì œ |

---

## ë‹¤ìŒ ë‹¨ê³„

- [ë°ì´í„° íë¦„](./04_ë°ì´í„°_íë¦„.md) ì´í•´í•˜ê¸°
- [API ë¬¸ì„œ](./05_API_ë¬¸ì„œ.md) ì°¸ì¡°í•˜ê¸°
- [ê°œë°œ ê°€ì´ë“œ](./06_ê°œë°œ_ê°€ì´ë“œ.md)ë¡œ ì‹œì‘í•˜ê¸°
